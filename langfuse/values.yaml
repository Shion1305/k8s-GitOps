# Langfuse Helm Chart Values
# Documentation: https://langfuse.com/self-hosting/deployment/kubernetes-helm

langfuse:
  service:
    type: ClusterIP
    port: 3000

  # Security configurations - secrets managed directly in Kubernetes
  nextauth:
    url: "https://langfuse.k.shion1305.com"
    secret:
      secretKeyRef:
        name: "langfuse-credentials"
        key: "NEXTAUTH_SECRET"

  salt:
    secretKeyRef:
      name: "langfuse-credentials"
      key: "SALT"

  encryptionKey:
    secretKeyRef:
      name: "langfuse-credentials"
      key: "ENCRYPTION_KEY"

  # Web deployment configuration
  web:
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 2000m
        memory: 2Gi
    pod:
      additionalEnv:
        - name: "AUTH_DISABLE_USERNAME_PASSWORD"
          value: "true"
        - name: "AUTH_GITHUB_CLIENT_ID"
          valueFrom:
            secretKeyRef:
              name: "langfuse-github-oauth-secret"
              key: "clientID"
        - name: "AUTH_GITHUB_CLIENT_SECRET"
          valueFrom:
            secretKeyRef:
              name: "langfuse-github-oauth-secret"
              key: "clientSecret"
        - name: "AUTH_GITHUB_ALLOW_ACCOUNT_LINKING"
          value: "true"

  # Worker deployment configuration
  worker:
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi

# PostgreSQL - use external PostgreSQL managed by postgres-operator
postgresql:
  deploy: false
  host: "langfuse.postgres-operator-deployment.svc.cluster.local"
  port: 5432
  auth:
    username: "langfuse"
    database: "langfuse"
    existingSecret: "langfuse-credentials"
    secretKeys:
      userPasswordKey: "DB_PASSWORD"

# ClickHouse - embedded deployment
clickhouse:
  enabled: true
  auth:
    existingSecret: "langfuse-credentials"
    existingSecretKey: "CLICKHOUSE_PASSWORD"
  persistence:
    enabled: true
    size: 20Gi
    storageClass: "longhorn-ssd"
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                  - shion-ubuntu-2505
  zookeeper:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: kubernetes.io/hostname
                  operator: In
                  values:
                    - shion-ubuntu-2505

# Redis - embedded deployment
redis:
  enabled: true
  auth:
    enabled: true
    existingSecret: "langfuse-credentials"
    existingSecretPasswordKey: "REDIS_PASSWORD"
  master:
    persistence:
      enabled: true
      size: 5Gi
      storageClass: "longhorn-ssd"
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: kubernetes.io/hostname
                  operator: In
                  values:
                    - shion-ubuntu-2505

# S3-compatible storage (MinIO)
s3:
  enabled: true
  auth:
    existingSecret: "langfuse-credentials"
    rootPasswordSecretKey: "S3_ROOT_PASSWORD"
  persistence:
    enabled: true
    size: 50Gi
    storageClass: "longhorn-ssd"
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                  - shion-ubuntu-2505

# Ingress disabled - managed separately via nginx-ssl
ingress:
  enabled: false
