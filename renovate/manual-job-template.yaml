# Manual Renovate Job Template
#
# This template allows you to manually trigger Renovate for a specific repository
# from the ArgoCD UI.
#
# HOW TO USE:
# 1. Open ArgoCD UI and navigate to the 'renovate' application
# 2. Click "Create" â†’ "From YAML"
# 3. Copy this template
# 4. Edit the following values:
#    - TARGET_REPOSITORY: Set to "owner/repo" (e.g., "Shion1305/k8s-GitOps")
#    - INSTALLATION_ID: Set to your GitHub App installation ID
#                       (Find this in GitHub App settings or webhook payloads)
# 5. Click "Create"
# 6. Monitor the job logs in ArgoCD or via kubectl
#
# NOTE: This is a template file and is NOT automatically deployed.
# It exists only for manual copying when needed.

apiVersion: batch/v1
kind: Job
metadata:
  # Job name will be auto-generated with timestamp
  generateName: renovate-manual-
  namespace: renovate
  labels:
    app.kubernetes.io/instance: renovate
    app.kubernetes.io/name: renovate
    triggered-by: manual
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: renovate
        app.kubernetes.io/name: renovate
    spec:
      serviceAccountName: renovate
      restartPolicy: Never
      securityContext:
        fsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
        seccompProfile:
          type: RuntimeDefault
      containers:
        - name: renovate
          image: ghcr.io/renovatebot/renovate:42.70.0
          imagePullPolicy: IfNotPresent
          command:
            - /bin/bash
            - /scripts/run-renovate-single.sh
          env:
            - name: RENOVATE_CONFIG_FILE
              value: /usr/src/app/config.json
            - name: LOG_LEVEL
              value: info
            # ===== EDIT THESE VALUES =====
            - name: TARGET_REPOSITORY
              value: "REPLACE_WITH_OWNER/REPO"  # e.g., "Shion1305/k8s-GitOps"
            - name: INSTALLATION_ID
              value: "REPLACE_WITH_INSTALLATION_ID"  # e.g., "12345678"
            # =============================
          envFrom:
            - secretRef:
                name: renovate-secret
          resources:
            limits:
              cpu: "2"
              memory: 2Gi
            requests:
              cpu: 500m
              memory: 512Mi
          volumeMounts:
            - name: config-volume
              mountPath: /usr/src/app/config.json
              subPath: config.json
            - name: scripts
              mountPath: /scripts
      volumes:
        - name: config-volume
          configMap:
            name: renovate-config
        - name: scripts
          configMap:
            name: renovate-scripts
            defaultMode: 0755
