# Renovate Helm Chart Values
# Official chart: https://github.com/renovatebot/helm-charts

# CronJob configuration
cronjob:
  enabled: true
  schedule: "0 */6 * * *"
  successfulJobsHistoryLimit: 1
  failedJobsHistoryLimit: 1
  concurrencyPolicy: Forbid
  # Override command to use wrapper script
  commandOverride:
    - /bin/bash
    - /scripts/run-renovate.sh

# Use existing secret created manually
existingSecret: "renovate-secret"

# Extra volumes for wrapper script
extraVolumes:
  - name: scripts
    configMap:
      name: renovate-scripts
      defaultMode: 0755

extraVolumeMounts:
  - name: scripts
    mountPath: /scripts

# Environment variables
env:
  LOG_LEVEL: "info"

# Renovate configuration
# Docs: https://docs.renovatebot.com/self-hosted-configuration/
renovate:
  # Main configuration as JSON string
  config: |
    {
      "platform": "github",
      "autodiscover": true,
      "autodiscoverFilter": ["Shion1305/*", "*/*"],
      "onboarding": true,
      "requireConfig": "required",
      "gitAuthor": "Automation by Shion1305 <bot@github.shion.pro>",
      "username": "renovate-by-shion1305[bot]",
      "repositories": [],
      "ignorePaths": [],
      "enabledManagers": [
        "argocd",
        "docker-compose",
        "dockerfile",
        "github-actions",
        "helm-values",
        "helmfile",
        "kubernetes",
        "kustomize",
        "custom.regex"
      ],
      "packageRules": [
        {
          "description": "Exclude archived repositories",
          "matchRepositories": ["**"],
          "enabled": true
        }
      ],
      "prConcurrentLimit": 10,
      "prHourlyLimit": 2,
      "timezone": "UTC"
    }

# Resource limits
resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 200m
    memory: 512Mi

# Pod configuration
securityContext:
  fsGroup: 1000
  runAsNonRoot: true
  runAsUser: 1000
  seccompProfile:
    type: RuntimeDefault

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

# Service account
serviceAccount:
  create: true
  name: renovate
