apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: argocd-guestbook-ingress
  namespace: argocd
  annotations:
    # SSL/HTTPS configuration
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    # HTTP method restriction: Only allow GET, HEAD, OPTIONS
    # All other methods (POST, PUT, DELETE, PATCH, etc.) will return 405 Method Not Allowed
    # This prevents anonymous users from making any state-changing requests via this endpoint
    # NOTE: Requires snippet annotations to be enabled in ingress-nginx controller
    # If snippets are disabled, consider using an API gateway, WAF, or service mesh for method filtering
    nginx.ingress.kubernetes.io/configuration-snippet: |
      if ($request_method !~ ^(GET|HEAD|OPTIONS)$) {
        return 405;
      }
spec:
  ingressClassName: nginx-ssl
  tls:
    - hosts:
        - guestbook.k.shion1305.com
  rules:
    - host: guestbook.k.shion1305.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: argocd-server
                port:
                  number: 443
