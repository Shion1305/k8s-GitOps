apiVersion: v1
kind: Service
metadata:
  name: timemachine
  namespace: macos-timemachine
  labels:
    app: timemachine
  annotations:
    # Restrict access to local network only
    metallb.universe.tf/allow-shared-ip: "timemachine"
    metallb.universe.tf/address-pool: "local-only"
spec:
  type: NodePort
  selector:
    app: timemachine
  ports:
  - name: netbios
    port: 139
    targetPort: 139
    protocol: TCP
    nodePort: 30139
  - name: microsoft-ds
    port: 445
    targetPort: 445
    protocol: TCP
    nodePort: 30445
  externalTrafficPolicy: Local
  sessionAffinity: ClientIP
