apiVersion: v1
kind: Service
metadata:
  name: timemachine
  namespace: macos-timemachine
  labels:
    app: timemachine
  annotations:
    # Restrict access to local network only
    metallb.universe.tf/allow-shared-ip: "timemachine"
    metallb.universe.tf/address-pool: "local-only"
    argocd.argoproj.io/sync-wave: "0"
spec:
  type: ClusterIP
  selector:
    app: timemachine
  ports:
    - name: udp137
      port: 137
      targetPort: 137
      protocol: UDP
    - name: udp138
      port: 138
      targetPort: 138
      protocol: UDP
    - name: tcp139
      port: 139
      targetPort: 139
      protocol: TCP
    - name: tcp445
      port: 445
      targetPort: 445
      protocol: TCP
  sessionAffinity: ClientIP
